本篇主要介绍黑盒测试的相关知识。   
黑盒测试又称功能测试或数据驱动测试，是针对软件的功能需求/实现进行测试，通过测试来检测每个功能是否符合需求，不考虑程序内部的逻辑结构。黑盒测试用例设计方法包括等价类划分法、边界值分析法、错误推测法、因果图法、判定表驱动法、正交试验设计法、功能图法、场景图法等。下面将对这些方法进行详细的介绍。
### 等价类划分法
定义：   
等价类划分法是把所有可能输入的数据，即程序的输入域划分成若干部分（子集），然后从每一个子集中选取少数具有代表性的数据作为测试用例。等价类划分方法是一种重要的、常用的黑盒测试用例设计方法。   
其中，等价类是指某个输入域的子集合。在该子集合中，各个输入数据对于揭露程序中的错误都是等效的（可以合理地假定：测试某等价类的代表值就等于对这一类其他值的测试），因此，可以把全部输入数据合理划分为若干等价类，在每一个等价类中取一个数据作为测试的输入条件就可以用少量代表性的测试数据取得较好的测试结果。等价类划分有两种不同的情况：有效等价类和无效等价类。   
有效等价类，是指对于程序的规格说明来说是合理的、有意义的输入数据构成的集合。利用有效等价类可检验程序是否实现了规格说明所规定的功能和性能。   
无效等价类 指对程序的规格说明是不合理的或无意义的输入数据所构成的集合。对于具体的问题，无效等价类至少应有一个，也可能多个。

划分等价类的原则：
1. 在输入条件规定了**取值范围**或**值的个数**的情况下，则可以确立一个有效等价类和两个无效等价类。
例如：序号取值范围为1~99.
一个有效等价类：1≤序号值≤99
两个无效等价类：序号值＜1；序号值＞99
2. 在输入条件规定了**输入值的集合**或者规定了“必须如何”的条件的情况下，可确立一个有效等价类和一个无效等价类。
例如：在C语言中对变量标识符命名规定为“以字母开头的”。
一个有效等价类：所有以字母开头命名的变量标识符
一个无效等价类：所有除去以字母开头命名的变量标识符
3. 在输入条件是一个**布尔量**的情况下，可确定一个有效等价类和一个无效等价类。
例如：0,1和true，false
4. 在规定了输入数据的**一组值**（假定n个），并且程序要对每一个输入值分别处理的情况下，可确立n个有效等价类和一个无效等价类。
例如：输入条件说明学历可为：专科、本科、硕士、博士四种之一，则分别取这四种值作为四个有效等价类，另外把这四种学历之外的任何学历作为无效等价类。
5. 在规定了输入数据**必须遵守的规则**情况下，可确立一个有效等价类（符合规则）和若干个无效等价类（从不同角度违反规则）。
6. 在确知已划分的等价类中各元素在程序处理中的方式不同的情况下，则应在将该等价类进一步的划分为更小的等价类。

每一个无效等价类至少要用一个测试用例，否则就有可能漏掉某一类错误，但允许若干个有效等价类合用同一个测试用例，以便进一步减少测试次数。

转化为测试用例：
在确立了等价类后，可建立等价类表，列出所有划分出的等价类输入条件：有效等价类、无效等价类，然后从划分出的等价类中按以下三个原则设计测试用例：
1）为每一个等价类规定一个唯一的编号；
2）设计一个新的测试用例，使其尽可能多地覆盖尚未被覆盖地有效等价类，重复这一步，直到所有的有效等价类都被覆盖为止；
3）设计一个新的测试用例，使其仅覆盖一个尚未被覆盖的无效等价类，重复这一步，直到所有的无效等价类都被覆盖为止。

### 边界值分析法
定义：边界值分析法就是对输入或输出的边界值进行测试的一种黑盒测试方法。通常边界值分析法是作为对等价类划分法的补充，这种情况下，其测试用例来自等价类的边界。   
与等价类区别：   
1）边界值分析不是从某等价类中随便挑一个作为代表，而是这个等价类的每个边界都要作为测试条件。   
2）边界值分析不仅考虑输入条件，还要考虑输出空间产生的测试情况。   

大量的错误是发生在输入或输出范围的边界上，而不是发生在输入输出范围的内部。因此针对各种边界情况设计测试用例，可以查出更多的错误。使用边界值分析方法设计测试用例，首先应确定边界情况。通常输入和输出等价类的边界，就是应着重测试的边界情况。应当选取正好等于，刚刚大于或刚刚小于边界的值作为测试数据，而不是选取等价类中的典型值或任意值作为测试数据。   

常见边界值：
 1）对16Bit的整数而言，32767和32768是边界   
 2）屏幕上光标在最左上、最右下位置   
 3）报表的第一行和最后一行   
 4）数组元素的第一个和最后一个   
 5）循环的第0次、第1次和倒数第2次、最后一次   
 
 分析方法：
1.  如果输入（输出）是一个取值范围或者值的个数，则以边界或者边界附近的值作为测试用例数据选取；
 例如，如果程序的规格说明中规定："重量在10公斤至50公斤范围内的邮件，其邮费计算公式为……"。作为测试用例，我们应取10及50，还应取10.01,49.99,9.99及50.01等。
2.  如果输入（输出）是一个有序的集合，则以第一个元素和最后一个元素作为测试用例数据选取；
3.  如果输入（输出）的值的个数是一个取值范围，则以最大值；最大值+1；最小值；最小值-1作为测试用例数据选取；
例如，一个输入文件应包括1~255个记录，则测试用例可取1和255，还应取0及256等。
4.  如果是一个内部数据结构，则以极限值作为测试用例数据选取；
5.  分析规格说明,找出其它可能的边界条件。

### 错误推测法
定义：基于经验和直觉推测程序中所有可能存在的各种错误，从而有针对性的设计测试用例的方法。
基本思想：列举出程序中所有可能有的错误和容易发生错误的特殊情况,根据他们选择测试用例。此方法应与其他方法一起使用。
例如，测试一个对线性表（比如数组）进行排序的程序，可推测列出以下几项需要特别测试的情况：   
1)    输入的线性表为空表；   
2)    表中只含有一个元素；   
3)    输入表中所有元素已排好序；   
4)    输入表已按逆序排好；   
5)    输入表中部分或全部元素相同。   

### 因果图法
因果图法是一种利用图解法分析输入的各种组合情况，从而设计测试用例的方法，它适合于检查程序输入条件的各种组合情况。等价类划分法和边界值分析方法都是着重考虑输入条件，但没有考虑输入条件的各种组合、输入条件之间的相互制约关系。这样虽然各种输入条件可能出错的情况已经测试到了，但多个输入条件组合起来可能出错的情况却被忽视了。如果在测试时必须考虑输入条件的各种组合，则可能的组合数目将是天文数字，因此必须考虑采用一种适合于描述多种条件的组合、相应产生多个动作的形式来进行测试用例的设计，这就需要利用因果图（逻辑模型）。
![因果图法](../../../images/photo/因果图.gif)
因果图中4种符号分别表示了规格说明中的4种因果关系。
同时使用了简单的逻辑符号，以直线联接左右结点。左结点表示输入状态（或称原因），右结点表示输出状态（或称结果）。
C1表示原因，通常置于图的左部；e1表示结果，通常在图的右部。C1和e1均可取值0或1，0表示某状态不出现，1表示某状态出现。
因果图有关概念：
1. 关系
恒等：若c1是1，则e1也是1；否则e1为0。
非：若c1是1，则e1是0；否则e1是1。
或：若c1或c2或c3是1，则e1是1；否则e1为0。“或”可有任意个输入。
与：若c1和c2都是1，则e1为1；否则e1为0。“与”也可有任意个输入。
2. 约束
输入状态相互之间还可能存在某些依赖关系，称为约束。例如,某些输入条件本身不可能同时出现。输出状态之间也往往存在约束。在因果图中,用特定的符号标明这些约束。
![约束](../../../images/photo/约束.jpg)
输入条件的约束有以下4种：
E约束（异）：a和b中至多有一个可能为1，即a和b不能同时为1。
I约束（或）：a、b和c中至少有一个必须是1，即 a、b 和c不能同时为0。
O约束（唯一）；a和b必须有一个，且仅有1个为1。
R约束（要求）：a是1时，b必须是1，即不可能a是1时b是0。
输出条件约束类型：
M约束（强制）：若结果a是1，则结果b强制为0

因果图法设计测试用例的步骤：
1)    分析软件规格说明描述，哪些是原因(即输入条件或输入条件的等价类），哪些是结果(即输出条件),并给每个原因和结果赋予一个标识符。   
2)    分析软件规格说明描述中的语义，找出原因与结果之间,原因与原因之间对应的关系，根据这些关系,画出因果图。   
3)    由于语法或环境限制,有些原因与原因之间,原因与结果之间的组合情况不可能出现，为表明这些特殊情况,在因果图上用一些记号表明约束或限制条件。   
4)    把因果图转换为判定表。   
5)    把判定表的每一列拿出来作为依据,设计测试用例。   

### 判定表驱动法
判定表是分析和表达多逻辑条件下执行不同操作情况的工具。其优点是能够将复杂的问题按照各种可能的情况全部列举出来，简明并避免遗漏。因此，利用判定表能够设计出完整的测试用例集合。在一些数据处理问题当中，某些操作的实施依赖于多个逻辑条件的组合，即：针对不同逻辑条件的组合值，分别执行不同的操作。判定表适合于处理这类问题。
判定表由四部分组成：  
1. 条件桩（ConditionStub）：列出了问题的所有条件。通常认为列出的条件的次序无关紧要。
2. 动作桩（Action Stub）：列出了问题规定可能采取的操作。这些操作的排列顺序没有约束。
3. 条件项（Condition Entry）：列出针对它左列条件的取值。在所有可能情况下的真假值。
4. 动作项（Action Entry）：列出在条件项的各种取值情况下应该采取的动作。

规则及规则合并：
规则：任何一个条件组合的特定取值及其相应要执行的操作称为规则。在判定表中贯穿条件项和动作项的一列就是一条规则。显然判定表中列出多少组条件取值，也就有多少条规则，既条件项和动作项有多少列。
化简：规则合并有两条或多条规则具有相同的动作，并且其条件项之间存在着极为相似的关系。

判定表建立步骤：
1. 确定规则的个数。假如有n个条件，每个条件有两个取值（0，1），故2n种规则。
2. 列出所有的条件桩和动作桩
3. 填入条件项
4. 填入动作项，等到初始判定表
5. 简化，合并相似规则（相同动作）

### 正交试验法
正交试验法是从大量的（实验）数据（测试例）中挑选适量的,有代表性的点（例）,从而合理地安排实验（测试）的一种科学实验设计方法.类似的方法有:聚类分析方法,因子方法方法等。

利用正交实验设计测试用例的步骤：
1. 提取功能说明，构造因子--状态表
把影响实验指标的条件称为因子。而影响实验因子的条件叫因子的状态。利用正交试验设计方法来设计测试用例时,首先要根据被测试软件的规格说明书找出影响其功能实现的操作对象和外部因素，把他们当作因子，而把各个因子的取值当作状态。对软件需求规格说明中的功能要求进行划分，把整体的概要性的功能要求进行层层分解与展开，分解成具体的有相对独立性的基本功能要求。这样就可以把被测试软件中所有的因子都确定下来，并为确定各因子的权值提供参考的依据。确定因子与状态是设计测试用例的关键。因此要求尽可能全面的正确的确定取值，以确保测试用例的设计做到完整与有效。
2. 加权筛选,生成因素分析表
对因子与状态的选择可按其重要程度分别加权。可根据各个因子及状态的作用大小，出现频率的大小以及测试的需要，确定权值的大小。
3. 利用正交表构造测试数据集
正交表的推导依据Galois理论。
利用正交试验设计方法设计测试用例，比使用等价类划分、边界值分析、因果图等方法有以下优点:节省测试工作工时；可控制生成的测试用例数量；测试用例具有一定的覆盖率。

### 功能图法
定义：功能图由状态迁移图和布尔函数组成。状态迁移图用状态和迁移来描述。一个状态指出数据输入的位置（或时间），而迁移则指明状态的改变。同时要依靠判定表或因果图表示的逻辑功能。

功能图介绍：
一个程序的功能说明通常由动态说明和静态说明组成。动态说明描述了输入数据的次序或转移的次序，静态说明描述了输入条件与输出条件之间的对应关系。对于较复杂的程序，由于存在大量的组合情况，因此仅用静态说明组成的规格说明对于测试来说往往是不够的。必须用动态说明来补充功能说明。功能图方法是用功能图FD形式化地表示程序的功能说明，并机械地生成功能图的测试用例。

功能图模型由状态迁移图和逻辑功能模型构成。状态迁移图用于表示输入数据序列以及相应的输出数据，在状态迁移图中，由输入数据和当前状态决定输出数据和后续状态。逻辑功能模型用于表示在状态中输入条件和输出条件之间的对应关系，逻辑功能模型只适合于描述静态说明，输出数据仅由输入数据决定。测试用例则是由测试中经过的一系列状态和在每个状态中必须依靠输入/输出数据满足的一对条件组成。功能图方法其实是是一种黑盒白盒混合用例设计方法。
（功能图方法中,要用到逻辑覆盖和路径测试的概念和方法，其属白盒测试方法中的内容。）

测试用例生成方法：
从功能图生成测试用例，得到的测试用例数是可接受的.。问题的关键的是如何从状态迁移图中选取测试用例。若用节点代替状态，用弧线代替迁移，则状态迁移图就可转化成一个程序的控制流程图形式，问题则转化为程序的路径测试问题（如白盒测试）了。

测试用例生成规则：
为了把状态迁移（测试路径）的测试用例与逻辑模型（局部测试用例）的测试用例组合起来，从功能图生成实用的测试用例，必须定义下面的规则：在一个结构化的状态迁移（SST）中，定义三种形式的循环:顺序，选择和重复。但分辨一个状态迁移中的所有循环是有困难的。

从功能图生成测试用例的过程：
1)    生成局部测试用例:在每个状态中，从因果图生成局部测试用例。局部测试用例由原因值（输入数据）组合与对应的结果值（输出数据或状态）构成。
2)    测试路径生成:利用上面的规则（三种）生成从初始状态到最终状态的测试路径。
3)    测试用例合成:合成测试路径与功能图中每个状态的局部测试用例。结果是初始状态到最终状态的一个状态序列,以及每个状态中输入数据与对应输出数据的组合。

测试用例的合成算法:采用条件构造树。

### 场景图法
定义：现在的软件几乎都是用事件触发来控制流程的，事件触发时的情景便形成了场景，而同一事件不同的触发顺序和处理结果就形成事件流。这种在软件设计方面的思想也可以引入到软件测试中，可以比较生动地描绘出事件触发时的情景，有利于测试设计者设计测试用例，同时使测试用例更容易理解和执行。
应用：
基本流和备选流：如下图所示，图中经过用例的每条路径都用基本流和备选流来表示，直黑线表示基本流，是经过用例的最简单的路径。备选流用不同的色彩表示，一个备选流可能从基本流开始，在某个特定条件下执行，然后重新加入基本流中（如备选流1和3）；也可能起源于另一个备选流（如备选流2），或者终止用例而不再重新加入到某个流（如备选流2和4）。
![场景图法](../../../images/photo/场景图法.jpg)